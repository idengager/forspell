#!/usr/bin/env ruby
require 'optimist'
require 'pry'
require 'backports/2.5.0/hash/slice'
require_relative '../lib/forspell'

puts 'Type --help for available options'

OPTION_KEYS = %i[
  include_paths
  exclude_paths
  dictionary_name
  custom_dictionary_path
  format
  logfile
  no_output
].freeze

opts = Optimist.options do
  opt :include_paths, 'Include additional directories, default: lib, app', type: :strings
  opt :exclude_paths, 'Specify subdirectories to exclude', type: :strings
  opt :dictionary_name, 'Use another hunspell dictionary', default: 'en_US', type: :string
  opt :custom_dictionary_path, 'Add your custom dictionary by specifying path', type: :string
  opt :format, 'Formats: readable, YAML, JSON', default: 'readable', type: :string
  opt :logfile, 'Log to file', type: :string
  opt :no_output, ''
end

if ARGV.empty?
  puts 'Please, specify working directory or file'
  exit(2)
end

Forspell.new(opts.slice(*OPTION_KEYS).merge(paths: ARGV)).process.total_errors.positive? ? exit(1) : exit(0)
